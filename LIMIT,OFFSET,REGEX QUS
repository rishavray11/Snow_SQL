-- Assigning the warehouse to the account 
USE WAREHOUSE COMPUTE_WH;

-- Creating a database named as SALES_DATABASE
CREATE DATABASE IF NOT EXISTS SQL_CLASS_15;

-- CREATING a schema for the SALES_DATABASE 
CREATE SCHEMA IF NOT EXISTS SQL_CLASS_15_SCHEMA;

-- USING THE DATABASE CREATED SALES_DATABASE 
USE DATABASE SQL_CLASS_15;

-- USING THE SCHEMA CREATED SALES_SCHEMA
USE SCHEMA SQL_CLASS_15_SCHEMA;

-- Creating a table 
CREATE TABLE ORDERS_DATA (
    order_id INT,
    customer_name VARCHAR(100),
    order_date DATE,
    product_category VARCHAR(50),
    product_name VARCHAR(100),
    quantity INT,
    price_per_unit DECIMAL(10,2),
    city VARCHAR(50),
    payment_mode VARCHAR(20)
);


-- Inserting some data inside the table 
INSERT INTO ORDERS_DATA VALUES
(101, 'Amit Shah', '2024-12-20', 'Electronics', 'Bluetooth Speaker', 2, 1500.00, 'Mumbai', 'UPI'),
(102, 'Bhavna Patel', '2025-01-15', 'Home Decor', 'Wall Painting', 1, 3000.00, 'Ahmedabad', 'Credit Card'),
(103, 'Amit Shah', '2025-02-18', 'Electronics', 'Earphones', 3, 500.00, 'Mumbai', 'Cash'),
(104, 'David Raju', '2025-03-05', 'Books', 'SQL Mastery', 2, 800.00, 'Hyderabad', 'Credit Card'),
(105, 'Bhavna Patel', '2025-03-22', 'Electronics', 'Smart Watch', 1, 7500.00, 'Ahmedabad', 'UPI'),
(106, 'Elina Roy', '2025-03-25', 'Books', 'Learn Python', 1, 900.00, 'Kolkata', 'Cash'),
(107, 'Amit Shah', '2025-04-01', 'Home Decor', 'Lamp Set', 2, 2000.00, 'Mumbai', 'Debit Card'),
(108, 'David Raju', '2025-04-15', 'Electronics', 'Power Bank', 1, 1200.00, 'Hyderabad', 'UPI'),
(109, 'Elina Roy', '2025-04-20', 'Books', 'Data Science 101', 3, 1000.00, 'Kolkata', 'Credit Card'),
(110, 'Bhavna Patel', '2025-04-25', 'Books', 'Regex for Beginners', 2, 600.00, 'Ahmedabad', 'Cash');

SELECT * FROM ORDERS_DATA;
-- Questions to solve 
-- Question 1 
/*
    Find the 2nd highest customer (based on total purchase amount) who placed at least 2 orders and used UPI or Credit Card as a payment mode.
    For each, display:
        1. Customer Name
        2. Total Orders
        3. Total Purchase Amount
        4. Average Order Value
        5. City
    Apply necessary filters and use appropriate groupings. Use OFFSET to display the 2nd highest only.
*/

SELECT CUSTOMER_NAME,
count(order_id) AS Total_Orders,
SUM(QUANTITY*PRICE_PER_UNIT) AS Total_Purchase_Amount,
AVG(QUANTITY*PRICE_PER_UNIT) AS Average_Order_Value,
CITY
FROM ORDERS_DATA
WHERE PAYMENT_MODE IN ('UPI','Credit Card')
group by CUSTOMER_NAME,city
having Total_Orders >=2
order by SUM(QUANTITY*PRICE_PER_UNIT) desc
limit 1 offset 1;



-- QUESTION 2 
/*
    From the ORDERS_DATA table, find all the Electronics or Book category orders where:
    Product name contains the word ‘Power’ or ends with ‘Python’ (use regex or LIKE)
    The order was placed in March or April 2025
    Show: Order ID, Customer Name (in UPPERCASE), Product Name, Order Date (formatted as Month-YYYY), Quantity, and Total Price
*/
SELECT
    ORDER_ID,
    UPPER(CUSTOMER_NAME),
    PRODUCT_NAME,
    TO_CHAR(ORDER_DATE,'MMMM-YYYY'),
    SUM(QUANTITY),
    SUM(QUANTITY*PRICE_PER_UNIT) AS TOTAL_PRICE
FROM ORDERS_DATA
WHERE PRODUCT_CATEGORY IN('Electronics','Books') AND PRODUCT_NAME LIKE '%Power%' OR PRODUCT_NAME LIKE '%Python' and order_date BETWEEN '2025-03-01' AND '2025-04-30'
GROUP BY customer_name,order_id, PRODUCT_NAME,order_date;

--REGEXP_LIKE(PRODUCT_NAME,'POWER|Python$')



SELECT ORDER_ID, UPPER(CUSTOMER_NAME) AS CUSTOMER_NAME, PRODUCT_NAME, TO_CHAR(ORDER_DATE,'MMMM-YYYY') AS MONTH_YEAR,
SUM(QUANTITY) AS QUANTITY,
SUM(QUANTITY * PRICE_PER_UNIT) AS TOTAL_AMOUNT
FROM ORDERS_DATA
WHERE PRODUCT_CATEGORY IN ('Electronics', 'Books')
and PRODUCT_NAME LIKE '%Power%' OR PRODUCT_NAME LIKE '%Python'
and MONTH(ORDER_DATE) IN (3,4)
AND YEAR(ORDER_DATE) = 2025
GROUP BY ORDER_ID, CUSTOMER_NAME, PRODUCT_NAME, ORDER_DATE;
-- QUESTION 3 
/*
    Find the monthly sales summary (Month-Year wise) for each product category.
    Only include months where the total quantity sold for that category is more than 3 units.
    Display:
        Month-Year (like Mar-2025)
        Product Category
        Total Quantity
        Total Sales Amount
        Average Price Per Unit (rounded to 2 decimal places)
*/
SELECT
    TO_CHAR(ORDER_DATE,'MON-YYYY') AS MONTH_YEAR,
    PRODUCT_CATEGORY,
    SUM(QUANTITY),
    SUM(QUANTITY*PRICE_PER_UNIT) AS TOTAL_SALES,
    ROUND(AVG(PRICE_PER_UNIT))
FROM ORDERS_DATA
GROUP BY PRODUCT_CATEGORY,MONTH_YEAR
HAVING SUM(QUANTITY)>3;


SELECT
TO_CHAR(ORDER_DATE, 'MON-YYYY') AS MONTH_YEAR,
PRODUCT_CATEGORY,
SUM(QUANTITY) AS TOTAL_QUANTITY,
SUM(QUANTITY * PRICE_PER_UNIT) AS TOTAL_SALES_AMOUNT,
ROUND(AVG(QUANTITY * PRICE_PER_UNIT), 2) AS AVERAGE_PRICE_PER_UNIT
FROM ORDERS_DATA
GROUP BY 
TO_CHAR(ORDER_DATE, 'MON-YYYY'),
PRODUCT_CATEGORY
HAVING SUM(QUANTITY) >3;

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
use role ACCOUNTADMIN;

USE WAREHOUSE COMPUTE_WH;
CREATE DATABASE IF NOT EXISTS SQL_PRACTICE;
USE DATABASE SQL_PRACTICE;
CREATE SCHEMA IF NOT EXISTS PRAC_SCHEMA;
USE SCHEMA PRAC_SCHEMA;



CREATE OR REPLACE TABLE SALES_DATA (
    ORDER_ID INT,
    CUSTOMER_NAME STRING,
    PRODUCT STRING,
    CATEGORY STRING,
    QUANTITY INT,
    PRICE FLOAT,
    ORDER_DATE DATE
);

INSERT INTO SALES_DATA VALUES
(1, 'Alice', 'PowerDrill', 'Tools', 2, 49.99, '2025-03-15'),
(2, 'Bob', 'PythonBook', 'Books', 1, 29.99, '2025-03-20'),
(3, 'Charlie', 'PowerBank', 'Electronics', 3, 19.99, '2025-04-01'),
(4, 'David', 'Desk Lamp', 'Furniture', 1, 39.99, '2025-02-12'),
(5, 'Eve', 'PythonMug', 'Merchandise', 2, 9.99, '2025-04-25'),
(6, 'Alice', 'Notebook', 'Stationery', 5, 4.99, '2025-03-05'),
(7, 'Frank', 'PowerAdapter', 'Electronics', 1, 14.99, '2025-04-10'),
(8, 'Grace', 'Whiteboard', 'Furniture', 1, 89.99, '2025-01-18');

SELECT * FROM SALES_DATA;
/*
Retrieve all records where the product category is "Electronics".

Find all sales where the quantity is greater than 2.

List orders placed in March or April 2025.
*/
SELECT *
FROM SALES_DATA
WHERE CATEGORY='Electronics';

SELECT *
FROM SALES_DATA
WHERE QUANTITY >2;

SELECT *
FROM SALES_DATA
--WHERE ORDER_DATE BETWEEN '2025-03-01'AND '2025-04-30';
--WHERE ORDER_DATE >='2025-03-01'AND ORDER_DATE <'2025-04-30';
WHERE MONTH(ORDER_DATE) IN (3,4) AND YEAR(ORDER_DATE) = 2025;

SELECT * FROM SALES_DATA;
/*
Find all products that contain the word "Power".

List products that start with the word "Python".
*/

SELECT *
FROM SALES_DATA
WHERE product like '%Power%';

SELECT *
FROM SALES_DATA
WHERE product like 'Python%';

/*Find all products that contain the word "Power" or end with "Python".

Retrieve products whose names contain only alphabetic characters.*/
SELECT * FROM SALES_DATA;

SELECT *
FROM SALES_DATA
WHERE REGEXP_LIKE(PRODUCT,'Power|Python$');

SELECT PRODUCT
FROM SALES_DATA
WHERE REGEXP_LIKE(CUSTOMER_NAME,'^[A-Za-z]+$');

/*Group the sales by customer and find total quantity purchased by each.

Calculate total revenue (quantity × price) for each product.

Show total sales count per category.*/
SELECT * FROM SALES_DATA;

SELECT 
    CUSTOMER_NAME,
    SUM(QUANTITY)
FROM SALES_DATA
GROUP BY CUSTOMER_NAME
ORDER BY SUM(QUANTITY) DESC ;

SELECT 
    PRODUCT,
    SUM(QUANTITY*PRICE) AS TOTAL_REVENUE
FROM SALES_DATA
GROUP BY PRODUCT;

SELECT 
    CATEGORY,
    COUNT(QUANTITY)
FROM SALES_DATA
GROUP BY CATEGORY
ORDER BY COUNT(QUANTITY) DESC;

/*Show customers who purchased more than 3 items in total.

List categories with total revenue greater than 100.

Find customers whose total purchase value exceeds 200.*/
SELECT * FROM SALES_DATA;

SELECT 
    CUSTOMER_NAME,
    SUM(QUANTITY)
FROM SALES_DATA
GROUP BY CUSTOMER_NAME
HAVING SUM(QUANTITY) >3;

SELECT 
    CATEGORY,
    SUM(QUANTITY*PRICE) AS TOTAL_REVENUE
FROM SALES_DATA
GROUP BY CATEGORY
HAVING TOTAL_REVENUE>100;

SELECT 
    CUSTOMER_NAME,
    SUM(QUANTITY*PRICE) AS TOTAL_PURCHASE
FROM SALES_DATA
GROUP BY CUSTOMER_NAME
HAVING TOTAL_PURCHASE >50;


SELECT *
FROM SALES_DATA
WHERE CUSTOMER_NAME ='Alice';









  
